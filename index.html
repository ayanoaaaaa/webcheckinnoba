<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>サイト運用＆リード活用診断</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f7fa;
      color: #222;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 8px;
      color: #333;
      font-weight: 700;
    }

    h2 {
      margin-top: 24px;
      font-size: 1.4rem;
      font-weight: 600;
      color: #444;
    }

    .section-card {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      margin-top: 20px;
      box-shadow: 0 6px 24px rgba(0,0,0,0.07);
    }

    .btn-primary {
      background: #0070f3;
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      margin-right: 8px;
    }

    .btn-secondary {
      background: #e4e4e7;
      color: #333;
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
    }

    .result-section-block {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-top: 24px;
      box-shadow: 0 5px 18px rgba(0,0,0,0.06);
    }

    .result-section-block h3 {
      margin-top: 0;
      font-size: 1.2rem;
      font-weight: 600;
      border-left: 4px solid #0070f3;
      padding-left: 10px;
      margin-bottom: 16px;
    }

    ul {
      padding-left: 20px;
      margin: 8px 0;
    }

    /* ウィジェットエリア用（崩れ防止） */
    .widget-wrapper {
      margin-top: 20px;
      width: 100%;
      min-height: 450px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>サイト運用＆リード活用診断</h1>
  <p>BtoB企業の「サイト運用」と「リード活用」の現在地を可視化する簡易診断ツールです。</p>

  <!-- STEP1 -->
  <div id="question-section" class="section-card">
    <h2>10問診断（はい／いいえ）</h2>
    <p>直感でお答えいただいて大丈夫です。</p>

    <div class="question-number" id="question-number"></div>
    <div class="question-text" id="question-text"></div>

    <button id="yes-btn" class="btn-primary">はい</button>
    <button id="no-btn" class="btn-secondary">いいえ</button>

    <p id="progress-note" style="margin-top:16px;color:#777;font-size:0.9rem;"></p>
  </div>

  <!-- STEP3 -->
  <div id="result-section" style="display:none;">
    <h2>診断結果レポート</h2>
    <div id="report-wrapper"></div>
    <button id="restart-btn" class="btn-secondary" style="margin-top:24px;">最初からやり直す</button>
  </div>
</div>

<script>
/* -----------------------
   質問データ
------------------------ */
const questions = [
  "ここ1年間、Webサイトの更新が「1ヶ月以上止まっていた月」がありましたか？",
  "直近3ヶ月で「ブログ・事例・お役立ち資料」の新規が3本未満でしたか？",
  "リードへのメール配信やMA運用ができていないと感じますか？",
  "営業から事例やコンテンツの所在確認が頻繁にありますか？",
  "主要サービスごとに「問い合わせ以外のCV」が設計できていないと感じますか？",
  "Web経由リードの商談化率・受注率を追えていない／活用できていないと感じますか？",
  "運用の主担当が1人に偏っている／片手間でやっている状態ですか？",
  "「とりあえずリニューアルしたい」という話が複数回出ているがゴールが曖昧ですか？",
  "経営層・部門長に成果レポートが刺さっていないと感じますか？",
  "既存顧客向けのナレッジ発信が不足していると感じますか？"
];

const typeQuestionMap = {
  A: [0, 6],
  B: [1, 4, 9],
  C: [2, 3, 5, 7, 8]
};

const typeDefinitions = {
  A: {
    label: "A：運用属人化タイプ",
    description:
      "Web運用が少人数に依存しており、更新が止まりやすい状態です。",
    failures: [
      "更新が担当者の忙しさに左右される",
      "ナレッジや手順が属人化している",
      "依頼ベースが多く全体最適がしづらい"
    ],
    actions: [
      "運用フローを明文化し共有",
      "月次更新スケジュール設定",
      "KPIを月1共有"
    ]
  },
  B: {
    label: "B：コンテンツ停滞タイプ",
    description:
      "情報発信の鮮度が落ち、更新が止まりやすい状態です。",
    failures: [
      "最新情報や事例更新が止まりやすい",
      "営業資料が不足しWeb活用が弱い",
      "コンテンツ案はあるが制作されない"
    ],
    actions: [
      "今期の3本だけテーマ確定",
      "FAQをそのままコンテンツ化",
      "社内→たたき / 外部→整形 の体制"
    ]
  },
  C: {
    label: "C：単発施策迷子タイプ",
    description:
      "施策の全体最適や成功基準が共有されていない状態です。",
    failures: [
      "成果がどこに効いたか不明瞭",
      "リニューアル目的が曖昧",
      "営業の個別依頼で追われがち"
    ],
    actions: [
      "KPIを1つに絞る",
      "ファネルでリード〜商談を可視化",
      "施策意図をA4にまとめ共有"
    ]
  },
  NONE: {
    label: "課題顕在化なし",
    description: "大きな課題は見られず基礎運用が整っている状態です。"
  }
};

const questionComments = [
  "更新が止まりやすい点は優先度見直しが必要です。",
  "テーマ設計から始めると効果が出やすいです。",
  "MAは簡易シナリオから始めるのが近道です。",
  "営業専用の資料入口を作ると負荷削減できます。",
  "CV設計が成果を大きく左右します。",
  "商談化率の見える化だけでも成果が出ます。",
  "属人化解消はリスク低減に直結します。",
  "目的言語化が最初の一歩になります。",
  "成果レポートは売上視点に絞ると刺さります。",
  "既存顧客向けTips配信は即効果が出ます。"
];

/* -----------------------
   状態
------------------------ */
let answers = [];
let currentQuestion = 0;

/* -----------------------
   初期表示
------------------------ */
window.onload = () => {
  answers = [];
  currentQuestion = 0;
  showQuestion();
};

function showQuestion() {
  document.getElementById("question-number").textContent =
    `質問 ${currentQuestion + 1} / 10`;
  document.getElementById("question-text").textContent =
    questions[currentQuestion];
  document.getElementById("progress-note").textContent =
    `ここまでの「はい」：${answers.filter(v => v === 1).length}件`;
}

/* -----------------------
   回答処理
------------------------ */
document.getElementById("yes-btn").onclick = () => handleAnswer(1);
document.getElementById("no-btn").onclick = () => handleAnswer(0);

function handleAnswer(v) {
  answers.push(v);
  if (currentQuestion < 9) {
    currentQuestion++;
    showQuestion();
  } else {
    document.getElementById("question-section").style.display = "none";
    showResult();
  }
}

/* -----------------------
   判定
------------------------ */
function calcType() {
  const scores = {
    A: typeQuestionMap.A.reduce((s, i) => s + answers[i], 0),
    B: typeQuestionMap.B.reduce((s, i) => s + answers[i], 0),
    C: typeQuestionMap.C.reduce((s, i) => s + answers[i], 0)
  };

  const total = scores.A + scores.B + scores.C;
  if (total === 0) return "NONE";

  const max = Math.max(scores.A, scores.B, scores.C);
  const tied = [];
  if (scores.A === max) tied.push("A");
  if (scores.B === max) tied.push("B");
  if (scores.C === max) tied.push("C");

  if (tied.length === 1) return tied[0];
  if (tied.includes("A")) return "A";
  if (tied.includes("B")) return "B";
  return "C";
}

/* -----------------------
   結果生成
------------------------ */
function showResult() {
  const type = calcType();
  const picked = answers
    .map((v,i)=>v===1?i:null)
    .filter(v=>v!==null)
    .slice(0,3);

  let html = "";

  /* NONE */
  if (type === "NONE") {
    html += `
      <div class="result-section-block">
        <h3>1. 冒頭サマリー</h3>
        <p>診断にご協力いただきありがとうございました。<br>
        大きな課題は見られませんでした。</p>
      </div>

      <div class="result-section-block">
        <h3>2. 今後の伸びしろ</h3>
        <ul>
          <li>月1の改善会議だけでも効果あり</li>
          <li>コンテンツの型化が有効</li>
          <li>リード活用シナリオを1本作ると成果が出る</li>
        </ul>
      </div>

      <div class="result-section-block">
        <h3>3. 最後に</h3>
        <p>必要であればカジュアル相談も可能です。</p>

        <div class="widget-wrapper">
          <div class="spir-widget" 
              data-url="https://app.spirinc.com/external/teams/CAmffWBX3ySDvtaeImHEr/availability-sharings/BjBcyr7Uvsc_P0GwDuO7C/confirm"
              style="min-width:320px;height:450px;">
          </div>
        </div>
      </div>
    `;

    renderResult(html);
    return;
  }

  /* 通常タイプ */
  const def = typeDefinitions[type];

  html += `
    <div class="result-section-block">
      <h3>1. 冒頭サマリー</h3>
      <p>ご回答内容から<strong>${def.label}</strong>の傾向が見られました。</p>
    </div>

    <div class="result-section-block">
      <h3>2. あなたのタイプ</h3>
      <p><strong>${def.label}</strong></p>
      <p>${def.description}</p>
    </div>

    <div class="result-section-block">
      <h3>3. よくある失敗パターン</h3>
      <ul>${def.failures.map(f=>`<li>${f}</li>`).join("")}</ul>
    </div>

    <div class="result-section-block">
      <h3>4. まず取り組むべき3つ</h3>
      <ul>${def.actions.map(a=>`<li>${a}</li>`).join("")}</ul>
    </div>

    <div class="result-section-block">
      <h3>5. 回答コメント</h3>
      <ul>
        ${
          picked.length === 0
          ? "<li>基盤整備を進めると効果が出やすいです。</li>"
          : picked.map(i=>`<li>${questionComments[i]}</li>`).join("")
        }
      </ul>
    </div>

    <div class="result-section-block">
      <h3>6. 最後に</h3>
      <p>もし少しでも気になる点があれば、オンライン相談も可能です。</p>

      <div class="widget-wrapper">
        <div class="spir-widget" 
            data-url="https://app.spirinc.com/external/teams/CAmffWBX3ySDvtaeImHEr/availability-sharings/BjBcyr7Uvsc_P0GwDuO7C/confirm"
            style="min-width:320px;height:450px;">
        </div>
      </div>
    </div>
  `;

  renderResult(html);
}

function renderResult(html) {
  document.getElementById("report-wrapper").innerHTML = html;
  document.getElementById("result-section").style.display = "block";

  /* ウィジェット読込（最後に実行 → 確実に表示される） */
  const script = document.createElement("script");
  script.src = "https://app.spirinc.com/js/external/iframe.js";
  script.async = true;
  document.body.appendChild(script);
}

/* -----------------------
   リスタート
------------------------ */
document.getElementById("restart-btn").onclick = () => {
  document.getElementById("result-section").style.display = "none";
  document.getElementById("question-section").style.display = "block";
  answers = [];
  currentQuestion = 0;
  showQuestion();
};
</script>
</body>
</html>
